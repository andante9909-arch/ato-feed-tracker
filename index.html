<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ì•„í†  4ì£¼ ê¸‰ì—¬ & ì²´ì¤‘ ê´€ë¦¬í‘œ (ì˜µì…˜ A)</title>
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <style>
    :root{--bg:#f6faff;--fg:#111;--muted:#64748b;--brand:#0ea5e9;--line:#e5e7eb;--card:#ffffff}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:15px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR","ë§‘ì€ ê³ ë”•",sans-serif}
    .wrap{max-width:980px;margin:20px auto;padding:16px}
    header{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .title{font-size:20px;font-weight:800;letter-spacing:-.2px}
    .badge{font-size:12px;color:white;background:#0ea5e9;padding:6px 10px;border-radius:999px;white-space:nowrap}
    .sub{color:#64748b;margin-top:4px}
    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin:10px 0 14px}
    @media(min-width:700px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff}
    .card b{display:block;font-size:12px;color:#64748b;margin-bottom:4px}
    .card .big{font-size:16px;font-weight:700}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 12px}
    button{appearance:none;border:1px solid #0ea5e9;color:#0ea5e9;background:#e0f2fe;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
    button:hover{filter:brightness(0.98)}
    .sheet{border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{position:sticky;top:0;background:#f8fafc;border-bottom:1px solid #e5e7eb;padding:10px 8px;font-weight:800;text-align:center}
    tbody td{border-bottom:1px solid #e5e7eb;padding:8px 8px;vertical-align:middle;text-align:center}
    tbody tr:nth-child(odd){background:#fcfcfc}
    .left{text-align:left}
    .kcal{color:#0b6c9c;font-weight:700;white-space:nowrap}
    .checkline{display:flex;align-items:center;gap:8px;justify-content:center}
    input[type="text"]{width:100%;max-width:120px;padding:8px;border:1px solid #e5e7eb;border-radius:8px}
    textarea{width:100%;min-height:34px;padding:8px;border:1px solid #e5e7eb;border-radius:8px;resize:vertical}
    tfoot td{padding:10px;border-top:1px solid #e5e7eb;background:#f8fafc}
    .footnote{font-size:12px;color:#64748b}
    .pill{display:inline-block;border:1px dashed #e5e7eb;padding:2px 8px;border-radius:999px;font-size:12px;margin-left:6px;color:#334155}
    .stickybar{position:sticky;bottom:10px;right:10px;display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
    .saveok{color:#059669;font-weight:700;display:none}
    @media print{.controls,.stickybar,.sub{display:none};@page{size:A4;margin:12mm}html,body{background:#fff}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">ğŸ¶ ì•„í†  4ì£¼ ê¸‰ì—¬ & ì²´ì¤‘ ê´€ë¦¬í‘œ</div>
        <div class="sub">ì˜µì…˜ A ê¸°ì¤€ Â· í•œ ë¼ <span class="kcal">240 kcal</span> Â· í•˜ë£¨ <span class="kcal">480 kcal</span> Â· ë„ê¸°ë„› 50g + RC 171g</div>
      </div>
      <div class="badge">ì €ì§€ë°© Â· ì·Œì¥ ì¼€ì–´ ì¹œí™”</div>
    </header>

    <div class="grid">
      <div class="card">
        <b>í˜¼í•© DMB</b>
        <div class="big">ë‹¨ë°±ì§ˆ 36.6% Â· ì§€ë°© 6.6% Â· íƒ„ìˆ˜ 41.1%</div>
        <div class="footnote">ì—ë„ˆì§€ êµ¬ì„±(ì¶”ì •): P 39% / F 17% / C 44%</div>
      </div>
      <div class="card">
        <b>ë¯¸ë„¤ë„ ë°¸ëŸ°ìŠ¤</b>
        <div class="big">Ca 0.95% Â· P 0.65% <span class="pill">Ca:P â‰ˆ 1.46 : 1</span></div>
        <div class="footnote">ê¶Œì¥ 1.1â€“1.8 : 1 (ìƒí•œ 2:1 ì´ë‚´)</div>
      </div>
      <div class="card">
        <b>ê¸‰ì—¬ ê°€ì´ë“œ</b>
        <div>ì•„ì¹¨Â·ì €ë… ë™ì¼: <b>ë„ê¸°ë„› 50g + RC 171g</b> (ê° 240 kcal)</div>
        <div class="footnote">ìœ ì‚°ê·  ë§¤ì¼, ì˜¤ë©”ê°€3 ì €ìš©ëŸ‰ ì‹œì‘ í›„ ê´€ì°°</div>
      </div>
    </div>

    <div class="controls">
      <button onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„ / PDF ì €ì¥</button>
      <button id="exportBtn">ë°ì´í„° ë‚´ë³´ë‚´ê¸°(JSON)</button>
      <label for="importFile" style="display:inline-block">
        <input id="importFile" type="file" accept="application/json" style="display:none"/>
        <span class="btn-like" style="border:1px solid #0ea5e9;color:#0ea5e9;background:#e0f2fe;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°(JSON)</span>
      </label>
      <button id="clearBtn">ì²´í¬/ì…ë ¥ ì´ˆê¸°í™”</button>
      <span id="saveFlag" class="saveok">âœ“ ìë™ ì €ì¥ë¨</span>
    </div>

    <div class="sheet">
      <table>
        <thead>
          <tr>
            <th style="width:70px">ë‚ ì§œ</th>
            <th>ì•„ì¹¨ (240 kcal)</th>
            <th>ì €ë… (240 kcal)</th>
            <th style="width:120px">í˜„ì¬ ì²´ì¤‘</th>
            <th style="width:110px">ì²´ì¤‘ ëª©í‘œ</th>
            <th class="left">ë³€ ìƒíƒœ / íŠ¹ì´ì‚¬í•­</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
        <tfoot>
          <tr>
            <td colspan="6" class="footnote">
              ë©”ëª¨: í•˜ë£¨ ì´ ê¸‰ì—¬ëŸ‰ = ë„ê¸°ë„› <b>100g</b> + RC <b>342g</b> (ì´ <b>480 kcal</b>) Â·
              ìœ ì‚°ê· ì€ ë§¤ ì‹ì‚¬ì™€ í•¨ê»˜ ë˜ëŠ” ì‹í›„ ê¸‰ì—¬ Â· ì˜¤ë©”ê°€3ëŠ” <b>ì €ìš©ëŸ‰(ì²´ì¤‘ 1kgë‹¹ 30â€“50mg EPA+DHA)</b>ìœ¼ë¡œ ì‹œì‘, ë³€ ìƒíƒœ ê´€ì°° Â·
              ì²´ì¤‘ì€ ë§¤ì£¼ ê°™ì€ ì‹œê°„(ì•„ì¹¨ ì‹ì „) ì¸¡ì • ê¶Œì¥
            </td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="stickybar">
      <button onclick="window.scrollTo({top:0,behavior:'smooth'})">â¬†ï¸ ë§¨ ìœ„ë¡œ</button>
      <button onclick="location.reload()">âŸ³ ìƒˆë¡œê³ ì¹¨</button>
    </div>
  </div>

  <script>
    // --- Config ---
    const DAYS = 28;
    const STORAGE_KEY = 'ato-feed-tracker-v1';
    const MORNING_TEXT = 'ë„ê¸°ë„› 50g + RC 171g';
    const EVENING_TEXT = 'ë„ê¸°ë„› 50g + RC 171g';
    const DEFAULT_TARGET = '21.0 kg';

    const $ = (q)=>document.querySelector(q);
    const tbody = $('#tbody');

    function loadState(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null') }catch{return null}
    }
    function saveState(){
      const data = exportData();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      const flag = document.getElementById('saveFlag');
      flag.style.display='inline-block';
      setTimeout(()=>flag.style.display='none', 1200);
    }

    function rowTemplate(i, state){
      const s = state?.rows?.[i]||{};
      return `
        <tr>
          <td>Day ${i+1}</td>
          <td>
            <div class="checkline">
              <input type="checkbox" data-k="am" ${s.am?'checked':''}>
              <label class="left">${MORNING_TEXT}</label>
            </div>
          </td>
          <td>
            <div class="checkline">
              <input type="checkbox" data-k="pm" ${s.pm?'checked':''}>
              <label class="left">${EVENING_TEXT}</label>
            </div>
          </td>
          <td><input type="text" data-k="now" placeholder="______ kg" value="${s.now||''}"></td>
          <td><input type="text" data-k="goal" value="${s.goal||state?.goal||DEFAULT_TARGET}"></td>
          <td class="left"><textarea data-k="note" placeholder="ë³€ ìƒíƒœ, ì‹ìš•, í™œë ¥ ë“± ë©”ëª¨">${s.note||''}</textarea></td>
        </tr>`;
    }

    function render(){
      const state = loadState()||{goal:DEFAULT_TARGET,rows:[]};
      tbody.innerHTML = Array.from({length:DAYS}, (_,i)=>rowTemplate(i,state)).join('');
      tbody.addEventListener('input', onEdit, {once:true, passive:true});
      tbody.addEventListener('change', onEdit, {once:true, passive:true});
    }

    function onEdit(){
      tbody.addEventListener('input', onEdit, {once:true, passive:true});
      tbody.addEventListener('change', onEdit, {once:true, passive:true});
      saveState();
    }

    function exportData(){
      const rows = [];
      tbody.querySelectorAll('tr').forEach(tr=>{
        const get = k => tr.querySelector(`[data-k="${k}"]`);
        rows.push({
          am: get('am').checked,
          pm: get('pm').checked,
          now: get('now').value,
          goal: get('goal').value,
          note: get('note').value
        });
      });
      const goal = rows[0]?.goal || DEFAULT_TARGET;
      return {goal, rows};
    }

    function importData(obj){
      if(!obj||!obj.rows){alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”');return}
      localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
      render();
    }

    // Buttons
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const data = exportData();
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'ato-feed-tracker.json'; a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('importFile').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{ importData(JSON.parse(reader.result)); }
        catch{ alert('JSON íŒŒì‹± ì˜¤ë¥˜'); }
      };
      reader.readAsText(file);
    });

    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(confirm('ëª¨ë“  ì²´í¬/ì…ë ¥ì„ ì´ˆê¸°í™”í• ê¹Œìš”? ë˜ëŒë¦´ ìˆ˜ ì—†ì–´ìš”.')){
        localStorage.removeItem(STORAGE_KEY);
        render();
      }
    });

    // PWA ë“±ë¡ (ì„œë¸Œê²½ë¡œì—ì„œë„ OK)
    if('serviceWorker' in navigator){
      window.addEventListener('load',()=>{
        navigator.serviceWorker.register('./service-worker.js');
      });
    }

    render();
  </script>
</body>
</html>
